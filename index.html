<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ShopHub • Premium Streetwear</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;900&display=swap" rel="stylesheet"/>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    /* (YOUR ORIGINAL CSS — UNCHANGED) */
    :root { --primary: #6366f1; --radius: 24px; --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Inter', sans-serif; background: #000; color: white; min-height: 100vh; overflow-x:hidden; }

    .navbar { background: rgba(0,0,0,0.7); backdrop-filter: blur(12px); padding: 1rem 2rem; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; }
    .nav-container { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 2rem; font-weight: 900; background: linear-gradient(90deg, #6366f1, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .nav-links a { color: white; text-decoration: none; font-weight: 600; margin-left: 2rem; opacity: 0.9; }
    .nav-links a:hover { opacity: 1; color: var(--primary); }
    .cart-icon { position:relative; font-size:1.6rem; cursor:pointer; }
    .cart-count { position:absolute; top:-8px; right:-10px; background:var(--primary); color:white; font-size:0.8rem; width:20px; height:20px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:800; }

    .hero { text-align: center; padding: 8rem 2rem 4rem; }
    .hero h1 { font-size: 4.5rem; font-weight: 900; margin-bottom: 1rem; background: linear-gradient(90deg, #fff, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .hero p { font-size: 1.4rem; opacity: 0.9; margin-bottom: 2.5rem; }

    .search-controls { display: flex; align-items: center; justify-content: space-between; gap: 2rem; max-width: 1400px; margin: 0 auto; padding: 0 2rem; flex-wrap: wrap; }
    .filter-sort { padding: 1rem 1.8rem; background: #111; border: 1px solid #333; border-radius: 50px; color: white; font-weight: 600; font-size: 1rem; outline: none; min-width: 180px; }

    .search-wrapper { position: relative; flex: 1; max-width: 650px; min-width: 280px; }
    .search-box { width: 100%; padding: 1.4rem 2rem; padding-left: 4.5rem; font-size: 1.2rem; border: none; border-radius: 50px; background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); color: white; outline: none; }

    .container { max-width: 1600px; margin: 0 auto; padding: 2rem; }
    .products-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 1.5rem; padding-bottom: 4rem; }
    .reel-card { position: relative; border-radius: var(--radius); overflow: hidden; aspect-ratio: 9/16; cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-decoration:none; color:inherit; }

    .reel-image { width: 100%; height: 100%; background-size: cover; background-position: center; }
    .reel-content { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: space-between; padding: 1.2rem; background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 40%); }

    .price-tag { align-self: flex-end; background: rgba(0,0,0,0.7); padding: 0.5rem 1rem; border-radius: 50px; font-weight: 800; font-size: 1.1rem; backdrop-filter: blur(10px); }
    .reel-title { font-size: 2rem; font-weight: 900; text-align: center; letter-spacing: 1.5px; line-height: 1.1; }

    .card-buttons { display: flex; flex-direction: column; gap: 0.6rem; align-items:center; width:100%; margin-top:1rem; }
    .view-btn, .add-to-cart-btn { border-radius: 50px; font-weight: 800; cursor: pointer; width: 65%; }
    .view-btn { background: transparent; color:white; border:2px solid white; padding:0.55rem 1.2rem; }
    .add-to-cart-btn { background:white; color:black; padding:0.6rem 1.2rem; }

    .cart-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); opacity:0; visibility:hidden; transition:0.4s; z-index:1500; }
    .cart-overlay.active { opacity:1; visibility:visible; }
    .cart-sidebar { position:fixed; top:0; right:-420px; width:420px; height:100vh; background:#0f0f0f; border-left:1px solid #222; padding:2rem; transition:0.5s; overflow-y:auto; }
    .cart-sidebar.open { right:0; }

    footer{ background:#0a0a0a; margin-top:8rem; padding:5rem 2rem 0; }

  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="logo">ShopHub</div>
      <div class="nav-links">
        <a href="#">New</a><a href="#">Men</a><a href="#">Women</a><a href="#">Sale</a>
        <a href="Admin/adLogin.html">My Vault</a>
        <a href="#" class="cart-icon" id="openCart">
          Cart <i class="fas fa-shopping-bag"></i>
          <span class="cart-count" id="cartCount">0</span>
        </a>
      </div>
    </div>
  </nav>

  <!-- Cart Sidebar -->
  <div class="cart-overlay" id="cartOverlay"></div>
  <div class="cart-sidebar" id="cartSidebar">
    <div class="cart-header">
      <h2>YOUR BAG</h2>
      <i class="fas fa-times close-cart" id="closeCart"></i>
    </div>

    <div class="cart-items" id="cartItems">
      <p class="empty-cart">Your bag is empty</p>
    </div>

    <div class="cart-total">Total: $<span id="cartTotal">0.00</span></div>
    <button class="checkout-btn">PROCEED TO CHECKOUT</button>
  </div>

  <!-- Hero -->
  <div class="hero">
    <h1>THE VAULT</h1>
    <p>Curated drops. Limited stock. For the culture.</p>

    <div class="search-controls">
      <select id="filterSelect" class="filter-sort"><option value="all">All Items</option></select>

      <div class="search-wrapper">
        <input type="text" id="searchInput" class="search-box" placeholder="Search the vault..." />
        <i class="fas fa-search search-icon"></i>
      </div>

      <select id="sortSelect" class="filter-sort">
        <option value="default">Featured</option>
        <option value="price-low">Price: Low → High</option>
        <option value="price-high">Price: High → Low</option>
        <option value="name">Name A–Z</option>
      </select>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="container">
    <div class="products-grid" id="productsGrid"></div>
  </div>

  <!-- Footer -->
  <footer>
    <p style="text-align:center; padding:2rem 0; opacity:0.6;">© 2025 ShopHub • Premium Streetwear</p>
  </footer>

<script>
const supabaseUrl = "https://nhyucbgjocmwrkqbjjme.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5oeXVjYmdqb2Ntd3JrcWJqam1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0OTQzNjAsImV4cCI6MjA3OTA3MDM2MH0.uu5ZzSf1CHnt_l4TKNIxWoVN_2YCCoxEZiilB1Xz0eE";
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

// PUBLIC IMAGE URL — NO SIGNED URL NEEDED!
function getPublicImageUrl(path) {
  if (!path) return "https://via.placeholder.com/800x1200/111/fff?text=No+Image";
  return `${supabaseUrl}/storage/v1/object/public/products/${path}`;
}

/* -----------------------------
   CART SYSTEM (unchanged)
--------------------------------*/
const cartSidebar = document.getElementById("cartSidebar");
const cartOverlay = document.getElementById("cartOverlay");
const openCartBtn = document.getElementById("openCart");
const closeCartBtn = document.getElementById("closeCart");
const cartItemsEl = document.getElementById("cartItems");
const cartTotalEl = document.getElementById("cartTotal");
const cartCountEl = document.getElementById("cartCount");
let cart = JSON.parse(localStorage.getItem("shophub_cart")) || [];
let allProducts = [];

openCartBtn.onclick = e => {
  e.preventDefault();
  cartSidebar.classList.add("open");
  cartOverlay.classList.add("active");
  renderCart();
};
closeCartBtn.onclick = () => {
  cartSidebar.classList.remove("open");
  cartOverlay.classList.remove("active");
};
cartOverlay.onclick = closeCartBtn.onclick;

function addToCart(product) {
  const existing = cart.find(i => i.id === product.id);
  if (existing) existing.quantity++;
  else cart.push({ ...product, quantity: 1 });
  localStorage.setItem("shophub_cart", JSON.stringify(cart));
  updateCartCount();
  alert(`${product.name} added to bag!`);
}

window.removeFromCart = id => {
  cart = cart.filter(i => i.id !== id);
  localStorage.setItem("shophub_cart", JSON.stringify(cart));
  updateCartCount();
  renderCart();
};

window.updateQuantity = (id, change) => {
  const item = cart.find(i => i.id === id);
  if (!item) return;
  item.quantity = Math.max(1, item.quantity + change);
  localStorage.setItem("shophub_cart", JSON.stringify(cart));
  updateCartCount();
  renderCart();
};

function updateCartCount() {
  cartCountEl.textContent = cart.reduce((s, i) => s + i.quantity, 0);
}

function renderCart() {
  if (cart.length === 0) {
    cartItemsEl.innerHTML = `<p class="empty-cart">Your bag is empty</p>`;
    cartTotalEl.textContent = "0.00";
    return;
  }
  cartItemsEl.innerHTML = cart.map(item => `
    <div class="cart-item">
      <img src="${getPublicImageUrl(item.image_url)}" alt="${item.name}">
      <div class="cart-item-info">
        <div class="cart-item-name">${item.name}</div>
        <div class="cart-item-price">$${item.price.toFixed(2)}</div>
        <div class="quantity-controls">
          <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">−</button>
          <span style="font-weight:700;">${item.quantity}</span>
          <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
        </div>
        <div class="remove-item" onclick="removeFromCart(${item.id})">Remove</div>
      </div>
    </div>
  `).join("");
  cartTotalEl.textContent = cart.reduce((s, i) => s + i.price * i.quantity, 0).toFixed(2);
}

/* -----------------------------
   LOAD & RENDER PRODUCTS — PUBLIC URLS ONLY
--------------------------------*/
const grid = document.getElementById("productsGrid");
const filterSelect = document.getElementById("filterSelect");
const searchInput = document.getElementById("searchInput");
const sortSelect = document.getElementById("sortSelect");

async function loadProducts() {
  const { data: products } = await supabase
    .from("products")
    .select("id,name,price,image_url,categories(name)")
    .order("id");

  allProducts = products || [];

  const categories = [...new Set(allProducts.map(p => p.categories?.name).filter(Boolean))];
  filterSelect.innerHTML = `<option value="all">All Items</option>` +
    categories.map(c => `<option value="${c.toLowerCase()}">${c}</option>`).join("");

  renderProducts(allProducts);
}

function renderProducts(list) {
  grid.innerHTML = list.map(p => {
    const img = getPublicImageUrl(p.image_url);
    const title = p.name.toUpperCase().replace(/ /g, "<br>");

    return `
      <a href="Home/viewproduct.html?id=${p.id}" class="reel-card">
        <div class="reel-image" style="background-image:url('${img}')">
          <div class="reel-content">
            <div class="price-tag">$${Number(p.price).toFixed(2)}</div>
            <div class="reel-title">${title}</div>
            <div class="card-buttons">
              <button class="view-btn" onclick="event.stopPropagation();">VIEW PRODUCT</button>
              <button class="add-to-cart-btn"
                onclick="event.preventDefault();event.stopPropagation();
                addToCart({id:${p.id},name:'${p.name.replace(/'/g,"\\'")}',price:${p.price},image_url:'${p.image_url}'});">
                ADD TO CART
              </button>
            </div>
          </div>
        </div>
      </a>
    `;
  }).join("");
}

function filterAndSort() {
  let filtered = allProducts;
  const query = searchInput.value.toLowerCase().trim();
  if (query) filtered = filtered.filter(p => p.name.toLowerCase().includes(query));
  const cat = filterSelect.value;
  if (cat !== "all") filtered = filtered.filter(p => (p.categories?.name || "").toLowerCase() === cat);

  const sort = sortSelect.value;
  filtered.sort((a,b) => {
    if (sort === "price-low") return a.price - b.price;
    if (sort === "price-high") return b.price - a.price;
    if (sort === "name") return a.name.localeCompare(b.name);
    return 0;
  });

  renderProducts(filtered);
}

searchInput.oninput = filterAndSort;
filterSelect.onchange = filterAndSort;
sortSelect.onchange = filterAndSort;

// Start
loadProducts();
updateCartCount();
</script>
  
</body>
</html>

